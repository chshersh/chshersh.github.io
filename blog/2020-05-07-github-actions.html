<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Dead simple cross-platform GitHub Actions for Haskell</title>
    <meta name="author" content="Dmitrii Kovanikov">
    <meta name="description" content="GitHub Actions CI settings for Haskell projects with Cabal and Stack">

    <link rel="stylesheet" href="/css/article.css">

    <!-- Metatags -->
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Dmitrii Kovanikov aka chshersh" />
    <meta property="og:title" content="Dead simple cross-platform GitHub Actions for Haskell" />
    <meta property="og:description" content="Dmitrii Kovanikov's Personas Web Space" />
    <meta property="og:url" content="https://chshersh.com" />
    <meta property="og:image" content="/images/logo.jpg" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Dead simple cross-platform GitHub Actions for Haskell" />
    <meta name="twitter:description" content="GitHub Actions CI settings for Haskell projects with Cabal and Stack" />
    <meta name="twitter:image:src" content="https://chshersh.com/images/logo.jpg" />
    <meta name="twitter:url" content="https://chshersh.com" />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon/favicon-16x16.png">
</head>
<body>
    <header>
      <h1>Dead simple cross-platform GitHub Actions for Haskell</h1>
    </header>

    <main>
<div class="home-button-container">
  <a href="/index.html" class="home-button"><strong>go ~to:Home</strong></a>
</div

<p>I have been looking for the perfect Continuous Integration (CI) for my Haskell projects for a while and found <a href="https://github.com/features/actions">Github Actions</a> to be absolute gold for that. I have been going back and forth between different CI platforms (Travis, AppVeyor, CircleCI), until recently I finally figured out the settings that include everything I need.</p>
<p>So, in this short blog post, I would like to present the easiest way to set up the GitHub Actions CI for Haskell projects I come up with.</p>
<h2 id="motivation">Motivation</h2>
<p>In one of my previous blog posts I’ve described <a href="https://chshersh.com/posts/2019-02-25-haskell-travis">Dead simple Travis CI settings</a> for Haskell projects. There I’ve also explained why it’s important to support both build tools and multiple GHC versions on CI. However, it’s tricky to define Travis CI config with a matrix for multiple GHC versions, multiple operating systems and multiple build tools at the same time. This is where GitHub Actions come to play!</p>
<p>The resulting GitHub Actions configuration has the following features:</p>
<ul>
<li>It is fast</li>
<li>It is short</li>
<li>Works on Linux, macOS and Windows</li>
<li>Supports multiple GHC versions</li>
<li>Builds your project with both <code>cabal</code> and <code>stack</code></li>
<li>Contains only single copy-pasteable file: the file doesn’t have any project-specific properties or variables</li>
<li>Can be enabled automatically: no need to visit some third-party site to start CI, just push a single file to your repo</li>
<li>It is free for open-source projects</li>
</ul>
<h2 id="the-config">The Config</h2>
<p>To not beat around the bush and just get to the point, below is the full config:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> CI</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a><span class="at">    </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">synchronize</span><span class="kw">,</span><span class="at"> opened</span><span class="kw">,</span><span class="at"> reopened</span><span class="kw">]</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">main</span><span class="kw">]</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a><span class="at">  </span><span class="fu">schedule</span><span class="kw">:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="co">    # additionally run once per week (At 00:00 on Sunday) to maintain cache</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">cron</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;0 0 * * 0&#39;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a><span class="at">  </span><span class="fu">cabal</span><span class="kw">:</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> ${{ matrix.os }} / ghc ${{ matrix.ghc }}</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ${{ matrix.os }}</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a><span class="at">        </span><span class="fu">os</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">ubuntu-latest</span><span class="kw">,</span><span class="at"> macOS-latest</span><span class="kw">,</span><span class="at"> windows-latest</span><span class="kw">]</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a><span class="at">        </span><span class="fu">cabal</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;3.6.2.0&quot;</span><span class="kw">]</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a><span class="at">        </span><span class="fu">ghc</span><span class="kw">:</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;8.10.7&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9.0.2&quot;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;9.2.1&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a><span class="at">        </span><span class="fu">exclude</span><span class="kw">:</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> macOS-latest</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a><span class="at">            </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">9.0.2</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> macOS-latest</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a><span class="at">            </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.10.7</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> windows-latest</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a><span class="at">            </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">9.0.2</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a><span class="at">          </span><span class="kw">-</span><span class="at"> </span><span class="fu">os</span><span class="kw">:</span><span class="at"> windows-latest</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a><span class="at">            </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.10.7</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> haskell/actions/setup@v1.2</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a><span class="at">      </span><span class="fu">id</span><span class="kw">:</span><span class="at"> setup-haskell-cabal</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Setup Haskell</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a><span class="at">        </span><span class="fu">ghc-version</span><span class="kw">:</span><span class="at"> ${{ matrix.ghc }}</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a><span class="at">        </span><span class="fu">cabal-version</span><span class="kw">:</span><span class="at"> ${{ matrix.cabal }}</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Configure</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a>        cabal configure --enable-tests --enable-benchmarks --enable-documentation --test-show-details=direct --write-ghc-environment-files=always</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Freeze</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>        cabal freeze</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/cache@v2</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Cache ~/.cabal/store</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> ${{ steps.setup-haskell-cabal.outputs.cabal-store }}</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a><span class="at">        </span><span class="fu">key</span><span class="kw">:</span><span class="at"> ${{ runner.os }}-${{ matrix.ghc }}-${{ hashFiles(&#39;cabal.project.freeze&#39;) }}</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>        cabal build all --only-dependencies</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>        cabal build all</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a>        cabal test all</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Documentation</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a>        cabal haddock</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a><span class="at">  </span><span class="fu">stack</span><span class="kw">:</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> stack / ghc ${{ matrix.ghc }}</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true"></a><span class="at">    </span><span class="fu">strategy</span><span class="kw">:</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true"></a><span class="at">      </span><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true"></a><span class="at">        </span><span class="fu">stack</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;2.7.3&quot;</span><span class="kw">]</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true"></a><span class="at">        </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">&quot;8.10.7&quot;</span><span class="kw">]</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true"></a></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true"></a></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> haskell/actions/setup@v1.2</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Setup Haskell Stack</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true"></a><span class="at">        </span><span class="fu">ghc-version</span><span class="kw">:</span><span class="at"> ${{ matrix.ghc }}</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true"></a><span class="at">        </span><span class="fu">stack-version</span><span class="kw">:</span><span class="at"> ${{ matrix.stack }}</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/cache@v2</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true"></a><span class="at">      </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Cache ~/.stack</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true"></a><span class="at">      </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true"></a><span class="at">        </span><span class="fu">path</span><span class="kw">:</span><span class="at"> ~/.stack</span></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true"></a><span class="at">        </span><span class="fu">key</span><span class="kw">:</span><span class="at"> ${{ runner.os }}-${{ matrix.ghc }}-stack</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true"></a></span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install dependencies</span></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true"></a>        stack build --system-ghc --test --bench --no-run-tests --no-run-benchmarks --only-dependencies</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true"></a>        stack build --system-ghc --test --bench --no-run-tests --no-run-benchmarks</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true"></a>        stack test --system-ghc</span></code></pre></div>
<p>Enabling such CI for your projects is completely effortless. All you need to do is create a file named <code>.github/workflows/ci.yml</code> with the above content and push it to your repository. That’s all! GitHub takes care of everything else for you.</p>
<p>Once all build errors are fixed, you can enjoy your well-deserved green CI 💚</p>
<figure>
<img src="https://user-images.githubusercontent.com/4276606/81208666-54ab5580-8fc7-11ea-9464-80e67ade7d7a.png" alt="" /><figcaption>All CI checks pass</figcaption>
</figure>
<h3 id="badge">Badge</h3>
<p>After you enable GitHub Actions CI for your project, you can also add a cute badge to your <code>README.md</code>. Copy the following line and replace <code>userName</code> and <code>repoName</code> with your own settings:</p>
<pre><code>[![GitHub CI](https://github.com/userName/repoName/workflows/CI/badge.svg)](https://github.com/userName/repoName/actions)</code></pre>
<h2 id="configuration-explanation">Configuration explanation</h2>
<p>If you want to understand why the configuration looks like it looks, below is a short explanation:</p>
<ol type="1">
<li>The configuration is powered by two GitHub Actions: <a href="@github(haskell):actions">haskell/actions/setup</a> and <a href="@github">actions/cache</a>). The <code>haskell/actions/setup</code> action is responsible for installing GHC, cabal and stack on different operating systems and providing some convenient utilities. The <code>actions/cache</code> action is responsible for caching your built artifacts as you might guess.</li>
<li>It builds your project using <code>cabal</code> with different GHC versions on Ubuntu. The GitHub Actions virtual environment comes with GHC, Cabal and Stack already pre-installed in there, so the CI is faster on Linux than on Windows or macOS at the moment.</li>
<li>Cache for <code>cabal</code> builds is based on the <em>cabal freeze</em> files. The <code>cache</code> GitHub Action doesn’t upload newer cache if the cache with such key already exists. This can be problematic when you starting developing a package and adding new dependencies. To improve the situation, the cache key is based on all project dependencies. Using this approach means that once you change dependencies, your project and all dependencies will be rebuilt from scratch. But when they are built, the whole cache will be reused next time.</li>
<li>Your project builds on macOS and Windows only using the latest (or working) GHC version. Building with multiple GHC versions on all three platforms usually doesn’t give you much. So instead of having a <code>N x M</code> matrix, it’s enough to have a <code>N + M - 1</code> matrix. Though, you can easily change this behaviour by removing relevant <code>exclude</code> sections.</li>
<li>The CI also configures the testing environment properly and runs your tests automatically with each build.</li>
<li>Dependencies are built in a separate step, so you can quickly see from the overview, which building step has failed — dependencies or your project.</li>
<li>The config is extensible and easily customizable. You can change step names and their commands, add new steps. You can even add releases in an easy way with such a system!</li>
</ol>
<h2 id="hlint">HLint</h2>
<p>One way you can improve this CI setup is by adding an HLint check to each CI run. This can be done pretty easily. For example, here is a separate job that downloads HLint and runs it:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="at">  </span><span class="fu">hlint</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> hlint</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v2</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Run HLint</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a><span class="at">         </span><span class="fu">HLINT_VERSION</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;3.2.7&quot;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a><span class="fu">      run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>        curl -L https://github.com/ndmitchell/hlint/releases/download/v${HLINT_VERSION}/hlint-${HLINT_VERSION}-x86_64-linux.tar.gz --output hlint.tar.gz</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a>        tar -xvf hlint.tar.gz</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a>        ./hlint-${HLINT_VERSION}/hlint src/ test/</span></code></pre></div>
<h2 id="dependabot">Dependabot</h2>
<p>The presented CI configuration specifies versions of used GitHub Actions. They can become outdated with time, and this blog post is not updated automatically to the latest versions of each mentioned GitHub Action.</p>
<p>Fortunately, you can use <a href="https://dependabot.com/">Dependabot</a> to move the burden of updating actions versions from your shoulders to tools.</p>
<p>To receive pull requests with version updates for used actions, add the <code>.github/dependabot.yml</code> file with the following content (assuming, that you already have labels <code>CI</code> and <code>dependencies</code> in your repository, but you can choose your own existing labels):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="fu">version</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="fu">updates</span><span class="kw">:</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">package-ecosystem</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;github-actions&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a><span class="at">    </span><span class="fu">directory</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;/&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a><span class="at">    </span><span class="fu">schedule</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a><span class="at">      </span><span class="fu">interval</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;daily&quot;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a><span class="at">    </span><span class="fu">commit-message</span><span class="kw">:</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a><span class="at">      </span><span class="fu">prefix</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;GA&quot;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a><span class="at">      </span><span class="fu">include</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;scope&quot;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="at">    </span><span class="fu">labels</span><span class="kw">:</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;CI&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;dependencies&quot;</span></span></code></pre></div>

<hr>
<blockquote>
<p>If you liked this blog post, consider supporting my work on GitHub Sponsors, or following me on the Internet:</p>
<ul>
<li><a target="_blank" href="https://github.com/sponsors/chshersh">GitHub Sponsors: @chshersh</a></li>
<li><a target="_blank" href="https://youtube.com/c/chshersh">YouTube: @chshersh</a></li>
<li><a target="_blank" href="https://x.com/ChShersh">𝕏: @chshersh</a></li>
<li><a target="_blank" href="https://bsky.app/profile/chshersh.com">BlueSky: @chshersh</a></li>
<li><a target="_blank" href="https://functional.cafe/@chshersh">Mastodon: functional.cafe@chshersh</a></li>
<li><a target="_blank" href="https://www.twitch.tv/chshersh">Twitch: @chshersh </a></li>
</ul>
</blockquote>
    </main>
</body>
</html>
