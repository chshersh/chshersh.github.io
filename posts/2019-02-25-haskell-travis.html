<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135017265-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-135017265-1');
    </script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Personal website and some blog posts">
  <meta name="author" content="Dmitrii Kovanikov">

  <title>Dead simple Haskell Travis settings for cabal and stack</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  <!-- Custom fonts for this template -->
  <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet">

  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  <!-- Custom styles for this template -->
  <link href="../css/resume.css" rel="stylesheet">
  <link href="../css/dracula.css" rel="stylesheet">
  <link href="../css/post.css" rel="stylesheet">

  <!-- Metatags -->
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="kodimensional by Dmitrii Kovanikov" />
  <meta property="og:title" content="kodimensional :: Dead simple Haskell Travis settings for cabal and stack" />
  <meta property="og:description" content="Travis CI settings for Haskell projects with cabal and stack" />
  <meta property="og:url" content="https://kodimensional.dev" />
  <meta property="og:image" content="/images/logo-yellow.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="kodimensional :: Dead simple Haskell Travis settings for cabal and stack" />
  <meta name="twitter:description" content="Travis CI settings for Haskell projects with cabal and stack" />
  <meta name="twitter:image:src" content="https://kodimensional.dev/images/logo-yellow.png" />
  <meta name="twitter:url" content="https://kodimensional.dev" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" sizes="57x57" href="../images/icons/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="../images/icons/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="../images/icons/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="../images/icons/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="../images/icons/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="../images/icons/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="../images/icons/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="../images/icons/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../images/icons/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="../images/icons/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../images/icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="../images/icons/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../images/icons/favicon-16x16.png">
  <link rel="manifest" href="../images/icons/manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/images/icons/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">

</head>

<body id="page-top">

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary" id="sideNav">
    <h2 class="mb-0 blog-name text-uppercase"><span class="text-white">ko</span>dimensional</h2>
    <p class="text-black d-lg-block d-none">by Dmitrii Kovanikov</p>

    <a class="navbar-brand js-scroll-trigger" href="../">
      <span class="d-block d-lg-none">Dmitrii Kovanikov</span>
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#about">λ &rarr; ABOUT</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#projects">λ &rarr; PROJECTS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#experience">λ &rarr; EXPERIENCE</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#consultancy">λ &rarr; CONSULTANCY</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#mentorship">λ &rarr; MENTORSHIP</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#talks">λ &rarr; TALKS</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#blog">λ &rarr; BLOG</a>
        </li>
        <li class="nav-item">
          <a class="nav-link js-scroll-trigger" href="../#contacts">λ &rarr; CONTACTS</a>
        </li>
      </ul>

    </div>

    <div class="social-icons row justify-content-center">
      <iframe src="https://github.com/sponsors/chshersh/button" title="Sponsor chshersh" height="35" width="50%" style="border: 0;"></iframe>
    </div>

    <div class="social-icons row justify-content-center">
        
        <div class="col-2 col-lg-4 py-1">
          <a href="https://twitter.com/chshersh" target="_blank">
              <i class="fab fa-twitter"></i>
          </a>
        </div>
        
        <div class="col-2 col-lg-4 py-1">
          <a href="https://github.com/chshersh" target="_blank">
              <i class="fab fa-github"></i>
          </a>
        </div>
        
        <div class="col-2 col-lg-4 py-1">
          <a href="https://youtube.com/c/chshersh" target="_blank">
              <i class="fab fa-youtube"></i>
          </a>
        </div>
        
        <div class="col-2 col-lg-4 py-1">
          <a href="https://www.reddit.com/user/chshersh" target="_blank">
              <i class="fab fa-reddit"></i>
          </a>
        </div>
        
        <div class="col-2 col-lg-4 py-1">
          <a href="https://stackoverflow.com/users/2900502/shersh" target="_blank">
              <i class="fab fa-stack-overflow"></i>
          </a>
        </div>
        
        <div class="col-2 col-lg-4 py-1">
          <a href="https://www.linkedin.com/in/chshersh/" target="_blank">
              <i class="fab fa-linkedin"></i>
          </a>
        </div>
        
    </div>

  </nav>

  <div class="container-fluid p-0">

      <section class="resume-section p-3 p-lg-5">
        <h2 class="text-center">Dead simple Haskell Travis settings for cabal and stack</h2>

        
	  <p class="text-center text-black"><strong>Created:</strong> February 25, 2019</p>
	

        

        <div class="col-12 tag-block text-center">
            
            <span class="post-tag"><a class="btn btn-outline-warning">haskell</a></span>
            
            <span class="post-tag"><a class="btn btn-outline-warning">ci</a></span>
            
            <span class="post-tag"><a class="btn btn-outline-warning">travis</a></span>
            
            <span class="post-tag"><a class="btn btn-outline-warning">cabal</a></span>
            
            <span class="post-tag"><a class="btn btn-outline-warning">stack</a></span>
            
        </div>

        <div class="post toc-header"><ul>
<li><a href="#the-config" id="toc-the-config">The Config</a></li>
<li><a href="#customization-hlint" id="toc-customization-hlint">Customization: HLint</a></li>
<li><a href="#how-to-set-up-travis-ci" id="toc-how-to-set-up-travis-ci">How to set up Travis CI</a></li>
<li><a href="#explanation-of-the-configuration-commands" id="toc-explanation-of-the-configuration-commands">Explanation of the configuration commands</a></li>
<li><a href="#reasoning-behind-such-a-ci-config" id="toc-reasoning-behind-such-a-ci-config">Reasoning behind such a CI config</a>
<ul>
<li><a href="#why-both-cabal-and-stack" id="toc-why-both-cabal-and-stack">Why both cabal and stack?</a></li>
<li><a href="#why-latest-3-major-ghc-versions" id="toc-why-latest-3-major-ghc-versions">Why latest 3 major GHC versions?</a></li>
</ul></li>
<li><a href="#conclusion" id="toc-conclusion">Conclusion</a></li>
<li><a href="#appendix" id="toc-appendix">Appendix</a>
<ul>
<li><a href="#cabal-only-configuration" id="toc-cabal-only-configuration">Cabal-only configuration</a></li>
<li><a href="#stack-only-configuration" id="toc-stack-only-configuration">Stack-only configuration</a></li>
</ul></li>
</ul></div>
        <div class="post"><p>Today I am going to share a simple <a href="https://travis-ci.com/">Travis CI</a> configuration for Haskell projects with you. The <code>.travis.yml</code> file presented in this blog post allows you to painlessly test your repository on the continuous integration service under multiple GHC versions and with both build tools — <a href="https://www.haskell.org/cabal/users-guide/">cabal-install</a> and <a href="https://docs.haskellstack.org/en/stable/README/">stack</a>. Note that the suggested settings do not include complex configuration steps that could possibly be required for some projects. However, they work amazingly well for most Haskell libraries and applications where a basic setup is enough!</p>
<h2 id="the-config"><a href="#the-config" class="anchor">The Config</a></h2>
<p>I’ll cut to the chase, here is the <code>.travis.yml</code> file that you can copy-paste to each Haskell project and enjoy (hopefully) the green CI status:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span><span class="at"> haskell</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span><span class="kw">:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cabal</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2.4&quot;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cache</span><span class="kw">:</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">directories</span><span class="kw">:</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;$HOME/.cabal/store&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;$HOME/.stack&quot;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;$TRAVIS_BUILD_DIR/.stack-work&quot;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">include</span><span class="kw">:</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">  # Cabal</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.2.2</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.4.4</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.6.5</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">  # Stack</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.6.5</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span><span class="at"> STACK_YAML=&quot;$TRAVIS_BUILD_DIR/stack.yaml&quot;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">install</span><span class="kw">:</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="kw">  - </span><span class="ch">|</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    if [ -z &quot;$STACK_YAML&quot; ]; then</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>      ghc --version</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>      cabal --version</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>      cabal new-update</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>      cabal new-build --enable-tests --enable-benchmarks</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    else</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>      # install stack</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>      curl -sSL https://get.haskellstack.org/ | sh</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      # build project with stack</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>      stack --version</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      stack build --system-ghc --test --bench --no-run-tests --no-run-benchmarks</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    fi</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="kw">  - </span><span class="ch">|</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    if [ -z &quot;$STACK_YAML&quot; ]; then</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>      cabal new-test --enable-tests</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    else</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>      stack test --system-ghc</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    fi</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="fu">notifications</span><span class="kw">:</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">email</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span></code></pre></div>
<h2 id="customization-hlint"><a href="#customization-hlint" class="anchor">Customization: HLint</a></h2>
<p>I want to point out some nice things about this config — it doesn’t
mention the project name anywhere and it doesn’t rely on any
additional shell scripts. Which means that you have the ability to
paste it in any Haskell project and it <strong>should just work</strong> out of the
box. Though, it’s not the only reason why I recommend it. This config
requires almost no maintenance, but at the same time, it is easily
extensible. For example, if you want to check your code with
<a href="http://hackage.haskell.org/package/hlint">HLint</a> on every CI run, you
just need to add the following line at the end of the <code>script</code>
section:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">-</span><span class="at"> curl -sSL https://raw.github.com/ndmitchell/hlint/master/misc/run.sh | sh -s .</span></span></code></pre></div>
<p>This command downloads the latest HLint version and runs the <code>hlint</code> executable on your project.</p>
<h2 id="how-to-set-up-travis-ci"><a href="#how-to-set-up-travis-ci" class="anchor">How to set up Travis CI</a></h2>
<p>A quick recap on how to make Travis CI work for your project:</p>
<ol type="1">
<li><a href="https://docs.travis-ci.com/user/tutorial/">Enable Travis CI for your GitHub account</a> if you haven’t done it before.</li>
<li>Enable Travis CI for your specific repository.</li>
<li>Copy-paste the given <code>.travis.yml</code> to your project.</li>
</ol>
<p>That’s all! Feel free to contact me if you have any problem setting up Travis CI for your Haskell projects with this config. I have done tons of <code>“Fix CI”</code> commits and learned about a lot of weird errors before figuring out the proper settings.</p>
<blockquote>
<p><strong>NOTE:</strong> If you build your project with <code>stack</code>, it is a good idea to put a
fully configured <code>stack.yaml</code> file to the repository. There you can specify
all the settings required for <code>stack</code> to build your project, but for basic
cases, it should be enough to have only the resolver in there:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>resolver<span class="op">:</span> lts<span class="op">-</span><span class="fl">13.26</span></span></code></pre></div>
</blockquote>
<h2 id="explanation-of-the-configuration-commands"><a href="#explanation-of-the-configuration-commands" class="anchor">Explanation of the configuration commands</a></h2>
<p>Here is a short description of the commands used in the script:</p>
<ol type="1">
<li><code>sudo: true</code> allows us to use more powerful CI environment and increases the speed of building.</li>
<li>When you use <code>language: haskell</code>, the GHC and cabal versions for Ubuntu are taken from <a href="https://launchpad.net/~hvr/+archive/ubuntu/ghc">Herbert V. Riedel’s ppa</a>.</li>
<li>Setting <code>git depth</code> to 5 decreases the time for cloning the GitHub repo, by pruning the amount of history (commits) of the repo that is fetched.</li>
<li><code>STACK_YAML</code> environment variable is used to distinguish between Cabal and Stack builds. If you want to test multiple GHC versions with <code>stack</code> you only need to create <code>stack-VERSION.yaml</code> file specific to GHC version and add the corresponding number of items to the <code>matrix</code>.</li>
<li><code>new-</code> commands are used for Cabal since they provide a modern way to build Haskell projects with <code>cabal-install</code> in <a href="https://www.haskell.org/cabal/users-guide/">nix-style local builds</a>.</li>
<li><code>--system-ghc</code> flag is important for <code>stack</code> builds. Since you get the GHC version from the CI, <code>stack</code> doesn’t need to download them separately. That’s why, do remember to add this flag to every <code>stack</code> command you’re using.</li>
<li>Email notifications are disabled because they quickly become annoying. But the <code>notifications</code> section allows you to add a Slack integration, which can be handy.</li>
</ol>
<h2 id="reasoning-behind-such-a-ci-config"><a href="#reasoning-behind-such-a-ci-config" class="anchor">Reasoning behind such a CI config</a></h2>
<p>As you can see from the config, it contains several opinionated decisions, which can appear redundant or suboptimal. Here I am going to reveal the reasoning behind them.</p>
<h3 id="why-both-cabal-and-stack"><a href="#why-both-cabal-and-stack" class="anchor">Why both cabal and stack?</a></h3>
<p>You may ask, why would I need to test my project with two build tools? The answer is to be friendlier to the rest of the Haskell community. Yes, there are several build tools for Haskell with <code>cabal</code> and <code>stack</code> being the most popular ones. But, unfortunately, if the project builds with one of the tools, it doesn’t guarantee that it would also build with the other (though it works in <em>most</em> cases).</p>
<ol type="1">
<li>If your project builds with <code>stack</code> it may still fail to build with <code>cabal</code>. For example, if you don’t specify library bounds in the <code>build-depends</code> section, cabal solver might not find a valid plan to build your package with.</li>
<li>If your project builds with <code>cabal</code> it may still fail to build with <code>stack</code>. For example, some of your dependencies might not be in the Stackage snapshot, so you would need to add them into the <code>extra-deps</code> section in <code>stack.yaml</code>.</li>
</ol>
<p>If you test your Haskell package on CI with both Cabal and Stack you provide a better user experience for users of both the build tools. As a maintainer of multiple open-source libraries and applications, I try to make the life of the contributors and users of my packages easier by providing support for both <code>cabal</code> and <code>stack</code>. The fewer steps they need to do in order to make my project work in their current environment, the more chances they don’t give up halfway through fighting with the tooling. Also, if your Haskell package builds with <code>cabal</code> and <code>stack</code>, you can add it to both <a href="http://hackage.haskell.org/">Hackage</a> and <a href="https://www.stackage.org/">Stackage</a>.</p>
<h3 id="why-latest-3-major-ghc-versions"><a href="#why-latest-3-major-ghc-versions" class="anchor">Why latest 3 major GHC versions?</a></h3>
<p>It is a huge temptation to use only the latest GHC version for your package with all brand new cool features. But even if migration to a newer GHC version is usually a painless process, it takes time for the whole Haskell ecosystem to catch up. And users of your Haskell package may still use a two year old GHC version. This usually happens in big applications where you cannot switch to a newer GHC version unless each of your dependencies supports it.</p>
<p>At the same time, it is highly desired to be able to bump up the version bounds only for some specific libraries (because of applied bug-fixes and performance improvements in the newer versions). But if newer versions require you to also switch to a newer compiler, you might not be able to do that because the migration of your application to a newer GHC version can be blocked by other libraries.</p>
<p>You can see why it is nice when libraries support older compiler versions as well. However, maintaining support for very old GHC versions might be a thankless and time-consuming thing to do. Also, the more GHC versions you test against on the CI, the more time you need to wait until CI passes. That’s why the latest 3 seem reasonable enough.</p>
<blockquote>
<p><strong>NOTE:</strong> you may notice from the configuration that the latest 3 GHC versions are tested only for <code>cabal-install</code> while <code>stack</code> builds only most recent version. This is done merely for convenience since in Stackage snapshots GHC versions are tightly coupled with dependency versions.</p>
</blockquote>
<h2 id="conclusion"><a href="#conclusion" class="anchor">Conclusion</a></h2>
<p>You can see now that it’s actually not that hard to run Travis CI for Haskell repositories! And the given configuration is easily extensible with more commands, like adding HLint, checking on a newer compiler version, building <a href="https://www.haskell.org/haddock/">Haddock</a> documentation, running benchmarks, etc. Dealing with CI errors requires time and patience. But at least with this config you don’t need to have multiple build tools and multiple GHC versions installed on your machine, you can delegate all this dirty work to the CI.</p>
<h2 id="appendix"><a href="#appendix" class="anchor">Appendix</a></h2>
<p>In some situations it’s not possible to run CI for your Haskell project with both build tools easily. So below I’m providing separate configurations for each build tool.</p>
<h3 id="cabal-only-configuration"><a href="#cabal-only-configuration" class="anchor">Cabal-only configuration</a></h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span><span class="at"> haskell</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cabal</span><span class="kw">:</span><span class="at"> </span><span class="st">&quot;2.4&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cache</span><span class="kw">:</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">directories</span><span class="kw">:</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;$HOME/.cabal/store&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">include</span><span class="kw">:</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.2.2</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.4.4</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.6.5</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">install</span><span class="kw">:</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> ghc --version</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cabal --version</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cabal new-update</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cabal new-build --enable-tests --enable-benchmarks</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> cabal new-test --enable-tests</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">notifications</span><span class="kw">:</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">email</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span></code></pre></div>
<h3 id="stack-only-configuration"><a href="#stack-only-configuration" class="anchor">Stack-only configuration</a></h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">language</span><span class="kw">:</span><span class="at"> haskell</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span><span class="kw">:</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cache</span><span class="kw">:</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">directories</span><span class="kw">:</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;$HOME/.stack&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="st">&quot;$TRAVIS_BUILD_DIR/.stack-work&quot;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">matrix</span><span class="kw">:</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">Include</span><span class="kw">:</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.2.2</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span><span class="at"> STACK_YAML=&quot;$TRAVIS_BUILD_DIR/stack-8.2.2.yaml&quot;</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.4.4</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span><span class="at"> STACK_YAML=&quot;$TRAVIS_BUILD_DIR/stack-8.4.4.yaml&quot;</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">ghc</span><span class="kw">:</span><span class="at"> </span><span class="fl">8.6.5</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">env</span><span class="kw">:</span><span class="at"> STACK_YAML=&quot;$TRAVIS_BUILD_DIR/stack.yaml&quot;</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">install</span><span class="kw">:</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> curl -sSL https://get.haskellstack.org/ | sh</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> stack --version</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> stack build --system-ghc --test --bench --no-run-tests --no-run-benchmarks</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="fu">script</span><span class="kw">:</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> stack test --system-ghc</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="fu">notifications</span><span class="kw">:</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">email</span><span class="kw">:</span><span class="at"> </span><span class="ch">false</span></span></code></pre></div></div>
    </section>

  </div>

  <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"> </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/js/bootstrap.bundle.min.js" integrity="sha384-VoPFvGr9GxhDT3n8vqqZ46twP5lgex+raTCfICQy73NLhN7ZqSfCtfSn4mLA2EFA" crossorigin="anonymous"></script>
  <!-- Plugin JavaScript -->

  <script src="../js/jquery.easing.min.js"></script>
  <!-- Code highlighting  -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js"></script>
  <script>hljs.initHighlightingOnLoad()</script>

  <!-- Custom scripts for this template -->
  <script src="../js/resume.min.js"></script>

</body>

</html>
